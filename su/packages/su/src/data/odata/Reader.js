/**
 *
 */
Ext.define('SU.data.odata.Reader', {
    extend: 'Ext.data.JsonReader',
    alternateClassName: ['SU.data.ODataReader', 'Ext.data.ODataReader'],
    alias: 'reader.odata',

    read: function (response) {
        var token;

        if (response) {
            if (response.status === 204) {
                // merge (update) requests come back with 204 and the json reader fails when parsing it
                // to circumvent that, return an empty set
                return this.nullResultSet;
            } else if (response.status === 201 && response.responseText) {
                // post (create) requests return results under d. as opposed to d.results
                // dynamically changing the root property is a no go, as extjs uses some autogenerated anonymous function for that
                // for now, reroot the results, this should be fairly safe given that sharepoint controls the format
                token = '{\r\n"d" : {\r\n"__metadata": {';

                console.log(response.responseText.indexOf(token));

                if (response.responseText.indexOf(token) >= 0) {
                    response.responseText = response.responseText.replace(
                        token,
                        '{\r\n"d" : {\r\n"results": {\r\n"__metadata": {'
                    );
                    response.responseText += '\r\n}';
                }
            }
        }

        return this.callParent(arguments);
    }
});
